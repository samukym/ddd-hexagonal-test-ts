# Purpose
Tecnical test I have made back in the days applying ddd + hexagonal/clean architecture. <b>It was intentionally overengineered</b> to showcase my architecture skills, but it does not necessarily represent the solution I would have implemented.

# Spec
The idea is simple: a number of different client applications will periodically send heartbeats to this service, and the service keeps track of them, periodically removing those that didn't send any heartbeats in some configured time frame.

### Endpoints

The service should expose the following endpoints:

- `POST /:group/:id`

    - registers an application instance in specified `group`
    - `id` is a unique identifier of application instance, generated by client
    - if instance is already registered, the `updatedAt` timestamp must be updated
    - the request body can specify meta information that will be attached to the instance
    - returns JSON with following structure:

        ```js
        {
            "id": "e335175a-eace-4a74-b99c-c6466b6afadd",   // echoed from path parameter
            "group": "particle-detector",                   // echoed from path parameter
            "createdAt": 1571418096158,                     // first registered heartbeat
            "updatedAt": 1571418124127,                     // last registered heartbeat
            "meta": {                                       // meta echoed from request body
                "foo": 1
            }
        }
        ```

- `DELETE /:group/:id`

    - unregisters an application instance

- `GET /`

    - returns a JSON array containing a summary of all currently registered groups as follows:

        ```js
        [
            {
                "group": "particle-detector",
                "instances": "4",               // the number of registered instances in this group
                "createdAt": 1571418124127,     // first heartbeat registered in this group
                "lastUpdatedAt": 1571418124127, // last heartbeat registered in this group
            },
            // ...
        ]
        ```

    - groups containing 0 instances should not be returned

- `GET /:group`

    - returns a JSON array describing instances of the `group`:

        ```js
        [
            {
                "id": "e335175a-eace-4a74-b99c-c6466b6afadd",
                "group": "particle-detector",
                "createdAt": 1571418096158,
                "updatedAt": 1571418124127,
                "meta": {
                    "foo": 1
                }
            },
            // ...
        ]
        ```

The service should periodically remove expired instances. The "age" of the most recent heartbeat of an instance to be considered expired should be configurable with environment variable and have a sensible default value.


## Install it and run it
Node version
> v19.8.1

Install deps
> npm i

Config file
> ./config/.env

<i>set DELETE_EXPIRED_APPS_SECS to -1 to disable the remove expired applications process</i>

Run the server
> npm start

Test 
>npm test

## Documentation
It can be found in docs/redoc-static.html


## Things I did not implement 
 - Documentate the response type. The tool I used for that gave some version errors and I didn't want to waste to much time here. Also, I guess it will be tested so you wont' have any problem to check the body type in the responses.
 - Add limit and offset params to paginate the results in the GET services.
 - Authtentication.
 - Proper logging and monit
 - Dockerize the app
 - Real database
